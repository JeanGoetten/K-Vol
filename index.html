<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>K-VOL Plot BTCUSDT</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="socket.io/socket.io.js"></script>
    </script>
</head>
<body>
    <h1><a href="https://github.com/Selbstdenker/K-Vol">K-VOL 0.01</a></h1>
    <h3>BTCUSDT - Binance </h3>Start: 1 minute
    <div id="chart"></div>
    <div id="graph"></div>
        <script>
            var get_data
            const socket = io()
            Plotly.plot('chart',[
                {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN UP MIN',
                    line: {
                        dash: 'dashdot',
                        width: 4,
                        color: 'blue',
                        shape: 'spline'
                    }
                }
                , {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN UP SEC',
                    line: {
                        dash: 'dashdot',
                        width: 2,
                        color: 'blue',
                        shape: 'spline'
                    }
                }
                , {
                    y: [get_data],
                    mode:'lines+markers',
                    name: 'REAL PRICE',
                    line: {
                        dash: 'solid',
                        width: 1,
                        color: 'black',
                        shape: 'spline'
                    },
                }
                , {
                    y: [get_data],
                    mode:'lines+markers',
                    name: 'IDEAL PRICE',
                    line: {
                        dash: 'dot',
                        width: 4,
                        color: 'lightgreen',
                        shape: 'spline'
                    },
                }, {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN DOWN SEC', 
                    line: {
                        dash: 'dashdot',
                        width: 2,
                        color: 'red',
                        shape: 'spline'
                    }
                }, {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN DOWN MIN', 
                    line: {
                        dash: 'dashdot',
                        width: 4,
                        color: 'red',
                        shape: 'spline'
                    }
                }
            ])
            var cnt = 0 
             socket.on('data', (data)=>{
                cnt++
                get_data = data
                console.log(get_data)
                Plotly.extendTraces('chart',{y:[[get_data.margin_up_m], 
                                                [get_data.margin_up_s],
                                                [get_data.price], 
                                                [get_data.ideal_price], 
                                                [get_data.margin_down_s], 
                                                [get_data.margin_down_m]
                                            ]}, [0, 1, 2, 3, 4, 5])

                if(cnt > 60){
                    Plotly.relayout('chart', {
                        xaxis: {
                            range: [cnt-60, cnt]
                        }
                    })
                }
            })
            
            var cnt2 = 0
            Plotly.plot('graph',[
                {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN UP HOUR',
                    line: {
                        dash: 'dashdot',
                        width: 6,
                        color: 'blue',
                        shape: 'spline'
                    }
                }
                , {
                    y: [get_data],
                    mode:'lines+markers',
                    name: 'REAL PRICE',
                    line: {
                        dash: 'solid',
                        width: 1,
                        color: 'black',
                        shape: 'spline'
                    },
                }
                , {
                    y: [get_data],
                    mode:'lines+markers',
                    name: 'IDEAL PRICE',
                    line: {
                        dash: 'dot',
                        width: 4,
                        color: 'lightgreen',
                        shape: 'spline'
                    },
                }, {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN DOWN HOUR', 
                    line: {
                        dash: 'dashdot',
                        width: 6,
                        color: 'red',
                        shape: 'spline'
                    }
                }
            ])
             socket.on('data', (data)=>{
                get_data = data
                console.log(get_data)
                Plotly.extendTraces('graph',{y:[[get_data.margin_up_h],
                                                [get_data.price], 
                                                [get_data.ideal_price], 
                                                [get_data.margin_down_h]
                                            ]}, [0, 1, 2, 3])

                cnt2++
                if(cnt2 > 600){
                    Plotly.relayout('graph', {
                        xaxis: {
                            range: [cnt-600, cnt]
                        }
                    })
                }
            })
        </script>
        2019 - MIT License
</body>
</html>