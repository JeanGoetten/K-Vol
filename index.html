<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>K-VOL Plot BTCUSDT</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="socket.io/socket.io.js"></script>
    </script>
</head>
<body>
    <h1><a href="https://github.com/Selbstdenker/K-Vol">K-VOL 0.01</a></h1>
    <h3>BTCUSDT - Binance </h3>
    <div id="chart"></div>
    <div id="graph"></div>
        <script>
            var get_data
            const socket = io()
            Plotly.plot('chart',[
                {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN UP(h)',
                    line: {
                        dash: 'dashdot',
                        width: 8,
                        color: 'blue',
                        shape: 'spline'
                    }
                }
                , {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN UP(m)',
                    line: {
                        dash: 'dashdot',
                        width: 4,
                        color: 'blue',
                        shape: 'spline'
                    }
                }
                , {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN UP(s)',
                    line: {
                        dash: 'dashdot',
                        width: 2,
                        color: 'blue',
                        shape: 'spline'
                    }
                }
                , {
                    y: [get_data],
                    mode:'lines+markers',
                    name: 'REAL PRICE',
                    line: {
                        dash: 'solid',
                        width: 1,
                        color: 'black',
                        shape: 'spline'
                    },
                }
                , {
                    y: [get_data],
                    mode:'lines+markers',
                    name: 'PREDICTED PRICE',
                    line: {
                        dash: 'dot',
                        width: 4,
                        color: 'lightgreen',
                        shape: 'spline'
                    },
                }, {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN DOWN(s)', 
                    line: {
                        dash: 'dashdot',
                        width: 2,
                        color: 'red',
                        shape: 'spline'
                    }
                }, {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN DOWN(m)', 
                    line: {
                        dash: 'dashdot',
                        width: 4,
                        color: 'red',
                        shape: 'spline'
                    }
                }, {
                    y: [get_data],
                    mode:'lines',
                    name: 'MARGIN DOWN(h)', 
                    line: {
                        dash: 'dashdot',
                        width: 8,
                        color: 'red',
                        shape: 'spline'
                    }
                }
            ])
            var cnt = 0 
             socket.on('data', (data)=>{
                cnt++
                get_data = data
                console.log(get_data)
                Plotly.extendTraces('chart',{y:[[get_data.margin_up_h], 
                                                [get_data.margin_up_m], 
                                                [get_data.margin_up_s],
                                                [get_data.price], 
                                                [get_data.ideal_price], 
                                                [get_data.margin_down_s], 
                                                [get_data.margin_down_m], 
                                                [get_data.margin_down_h], 
                                            ]}, [0, 1, 2, 3, 4, 5, 6, 7])

                if(cnt > 120){
                    Plotly.relayout('chart', {
                        xaxis: {
                            range: [cnt-120, cnt]
                        }
                    })
                }
            })
        </script>
        2019 - MIT License
</body>
</html>